{"version":3,"file":"index.6e911b70.js","sources":["../../vite/modulepreload-polyfill","../../vite/preload-helper","../../main.ts"],"sourcesContent":["const p = function polyfill() {\n    const relList = document.createElement('link').relList;\n    if (relList && relList.supports && relList.supports('modulepreload')) {\n        return;\n    }\n    for (const link of document.querySelectorAll('link[rel=\"modulepreload\"]')) {\n        processPreload(link);\n    }\n    new MutationObserver((mutations) => {\n        for (const mutation of mutations) {\n            if (mutation.type !== 'childList') {\n                continue;\n            }\n            for (const node of mutation.addedNodes) {\n                if (node.tagName === 'LINK' && node.rel === 'modulepreload')\n                    processPreload(node);\n            }\n        }\n    }).observe(document, { childList: true, subtree: true });\n    function getFetchOpts(script) {\n        const fetchOpts = {};\n        if (script.integrity)\n            fetchOpts.integrity = script.integrity;\n        if (script.referrerpolicy)\n            fetchOpts.referrerPolicy = script.referrerpolicy;\n        if (script.crossorigin === 'use-credentials')\n            fetchOpts.credentials = 'include';\n        else if (script.crossorigin === 'anonymous')\n            fetchOpts.credentials = 'omit';\n        else\n            fetchOpts.credentials = 'same-origin';\n        return fetchOpts;\n    }\n    function processPreload(link) {\n        if (link.ep)\n            // ep marker = processed\n            return;\n        link.ep = true;\n        // prepopulate the load record\n        const fetchOpts = getFetchOpts(link);\n        fetch(link.href, fetchOpts);\n    }\n};__VITE_IS_MODERN__&&p();","const scriptRel = 'modulepreload';const seen = {};const base = '';export const __vitePreload = function preload(baseModule, deps) {\n    // @ts-ignore\n    if (!__VITE_IS_MODERN__ || !deps || deps.length === 0) {\n        return baseModule();\n    }\n    return Promise.all(deps.map((dep) => {\n        // @ts-ignore\n        dep = `${base}${dep}`;\n        // @ts-ignore\n        if (dep in seen)\n            return;\n        // @ts-ignore\n        seen[dep] = true;\n        const isCss = dep.endsWith('.css');\n        const cssSelector = isCss ? '[rel=\"stylesheet\"]' : '';\n        // @ts-ignore check if the file is already preloaded by SSR markup\n        if (document.querySelector(`link[href=\"${dep}\"]${cssSelector}`)) {\n            return;\n        }\n        // @ts-ignore\n        const link = document.createElement('link');\n        // @ts-ignore\n        link.rel = isCss ? 'stylesheet' : scriptRel;\n        if (!isCss) {\n            link.as = 'script';\n            link.crossOrigin = '';\n        }\n        link.href = dep;\n        // @ts-ignore\n        document.head.appendChild(link);\n        if (isCss) {\n            return new Promise((res, rej) => {\n                link.addEventListener('load', res);\n                link.addEventListener('error', rej);\n            });\n        }\n    })).then(() => baseModule());\n}","import type { TransformOptions } from \"esbuild\";\n\ntype esbuild_t = typeof import(\"esbuild\");\n\nconst $ = (sel: string) => document.querySelector(sel)!;\n\nfunction leave(el: Element, ms = 200) {\n    el.classList.add(\"leave\", \"leave-active\");\n    requestAnimationFrame(() => {\n        el.classList.remove(\"leave\");\n        el.classList.add(\"leave-to\");\n    });\n    setTimeout(() => el.remove(), ms);\n}\n\nconst JsDelivrAPI = \"https://data.jsdelivr.com/v1/package/npm/esbuild-wasm\";\nconst urlPrefix = \"https://cdn.jsdelivr.net/npm/esbuild-wasm\";\nconst urls = {\n    browser: (version: string) => `${urlPrefix}@${version}/esm/browser.js`,\n    wasm: (version: string) => `${urlPrefix}@${version}/esbuild.wasm`,\n};\n\nlet esbuild: esbuild_t | undefined;\nconst utils = {\n    async fetchVersion() {\n        const r = await fetch(JsDelivrAPI).then((r) => r.json());\n        const version = r.tags.latest;\n        localStorage.setItem(\"esbuild-repl\", `${version}:${Date.now()}`);\n        return version;\n    },\n    async version() {\n        const raw = localStorage.getItem(\"esbuild-repl\");\n        if (raw) {\n            const [version, time] = raw.split(\":\", 2);\n            if (Date.now() - +time < 86400 * 1000) {\n                return version;\n            }\n        }\n        return this.fetchVersion();\n    },\n    async esbuild(version: string) {\n        esbuild = (await import(/* @vite-ignore */ urls.browser(version))) as esbuild_t;\n        await esbuild.initialize({ wasmURL: urls.wasm(version) });\n    },\n    dashize(str: string) {\n        return str.replace(/([A-Z])/g, (x) => \"-\" + x.toLowerCase());\n    },\n    camelize(str: string) {\n        return str.replace(/-([a-z])/g, (x) => x.substring(1).toUpperCase());\n    },\n    cfg2cli(config: Record<string, any>) {\n        const options: string[] = [];\n        for (const key in config) {\n            const value = config[key as keyof TransformOptions];\n            if (Array.isArray(value)) {\n                for (const e of value) {\n                    options.push(`--${this.dashize(key)}:${e}`);\n                }\n            } else if (value instanceof Object) {\n                for (const [k, v] of Object.entries(value)) {\n                    options.push(`--${this.dashize(key)}:${k}=${v}`);\n                }\n            } else if (value === true) {\n                options.push(`--${this.dashize(key)}`);\n            } else {\n                options.push(`--${this.dashize(key)}=${value}`);\n            }\n        }\n        return options.join(\" \");\n    },\n    cli2cfg(line: string) {\n        const config: Record<string, any> = {};\n        for (const piece of line.split(/\\s+/)) {\n            if (!piece.startsWith(\"--\")) continue;\n            const a = piece.substring(2);\n            const colon = a.indexOf(\":\");\n            const equal = a.indexOf(\"=\");\n            if (colon === -1 && equal === -1) {\n                config[this.camelize(a)] = true;\n            } else {\n                if (colon !== -1 && colon < equal) {\n                    const key = a.substring(0, colon);\n                    const [k, v] = a.substring(colon + 1).split(\"=\", 2);\n                    config[this.camelize(key)] ||= {};\n                    config[this.camelize(key)][k] = v;\n                } else if (colon !== -1 && equal === -1) {\n                    const [key, value] = a.split(\":\", 2);\n                    config[this.camelize(key)] ||= [];\n                    config[this.camelize(key)].push(value);\n                } else {\n                    const [key, value] = a.split(\"=\", 2);\n                    const val = { true: true, false: false }[value] || value;\n                    config[this.camelize(key)] = val;\n                }\n            }\n        }\n        return config;\n    },\n    loadQuery() {\n        const query = new URLSearchParams(location.search.slice(1));\n        const version = query.get(\"version\");\n        const shareableString = query.get(\"shareable\");\n        let shareable: { code: string; config: Record<string, any> } | null = null;\n        if (shareableString) {\n            try {\n                shareable = JSON.parse(decodeURIComponent(atob(shareableString)));\n            } catch {}\n        }\n        return { version, shareable };\n    },\n    updateQuery(version: string, shareable: object) {\n        const query = new URLSearchParams();\n        query.set(\"version\", version);\n        query.set(\"shareable\", btoa(encodeURIComponent(JSON.stringify(shareable))));\n        const url = location.origin + location.pathname + \"?\" + query.toString();\n        history.pushState({ path: url }, \"\", url);\n    },\n    showError(message: string) {\n        const el = $(\"#error\") as HTMLElement;\n        el.style.display = \"\";\n        el.textContent = message;\n    },\n    hideError() {\n        const el = $(\"#error\") as HTMLElement;\n        el.style.display = \"none\";\n    },\n};\n\n(async function () {\n    const query = utils.loadQuery();\n    console.log(query);\n\n    $(\"#theme\").addEventListener(\"click\", () => {\n        document.body.classList.toggle(\"light\");\n    });\n    const version = query.version || (await utils.version());\n    $(\"#version\").textContent = version;\n\n    let $config = $(\"#config\") as HTMLInputElement;\n    let $output = $(\"#output\") as HTMLTextAreaElement;\n    let $editor = $(\"#editor\") as HTMLTextAreaElement;\n\n    if (query.shareable?.config != null) {\n        $config.value = utils.cfg2cli(query.shareable?.config);\n    }\n\n    if (query.shareable?.code != null) {\n        $editor.value = query.shareable?.code;\n        $output.value = \"// initializing...\";\n    }\n\n    await utils.esbuild(version);\n    (window as any).esbuild = esbuild;\n\n    leave($(\"#mask\"));\n\n    let config = utils.cli2cfg($config.value);\n    let code = $editor.value;\n\n    $config.addEventListener(\"change\", () => {\n        config = utils.cli2cfg($config.value);\n        $config.value = utils.cfg2cli(config);\n        refresh();\n    });\n\n    $editor.addEventListener(\"keydown\", (e: KeyboardEvent) => {\n        if (e.key === \"Tab\") {\n            e.preventDefault();\n            const textarea = $editor;\n            const code = textarea.value;\n            const before = code.substring(0, textarea.selectionStart);\n            const endPos = textarea.selectionEnd;\n            const after = code.substring(endPos);\n            textarea.value = before + \"    \" + after;\n            textarea.selectionStart = textarea.selectionEnd = endPos + 4;\n        }\n    });\n\n    async function refresh(first = false) {\n        code = $editor.value;\n        try {\n            const t = performance.now();\n            const result = await esbuild?.transform(code, config);\n            const duration = performance.now() - t;\n            if (result) {\n                $output.value = result.code;\n                utils.hideError();\n                if (!first) $(\"#duration\").textContent = duration.toFixed(2) + \"ms\";\n            }\n        } catch (e) {\n            utils.showError((e as Error).message);\n        }\n        try {\n            utils.updateQuery(version, { code, config });\n        } catch {}\n    }\n\n    $editor.addEventListener(\"input\", () => refresh(false));\n\n    refresh(true);\n})().catch(reason => {\n    console.error(reason);\n    $(\"#mask\").textContent = reason?.message || reason;\n});\n\nif (import.meta.env.PROD)\n    navigator.serviceWorker\n        .register(\"./sw.js\")\n        .then(e => console.log(\"registered sw.js in scope:\", e.scope))\n        .catch(e => console.log(\"failed to register sw.js:\", e));\n\nif (import.meta.env.DEV)\n    navigator.serviceWorker.getRegistrations().then(rs => rs.map(r => r.unregister()));\n"],"names":[],"mappings":"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"}