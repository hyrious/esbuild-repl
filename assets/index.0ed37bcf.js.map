{"version":3,"file":"index.0ed37bcf.js","sources":["../../vite/dynamic-import-polyfill","../../vite/preload-helper","../../main.ts"],"sourcesContent":["const p = function polyfill(modulePath = '.', importFunctionName = '__import__') {\n    try {\n        self[importFunctionName] = new Function('u', `return import(u)`);\n    }\n    catch (error) {\n        const baseURL = new URL(modulePath, location);\n        const cleanup = (script) => {\n            URL.revokeObjectURL(script.src);\n            script.remove();\n        };\n        self[importFunctionName] = (url) => new Promise((resolve, reject) => {\n            const absURL = new URL(url, baseURL);\n            // If the module has already been imported, resolve immediately.\n            if (self[importFunctionName].moduleMap[absURL]) {\n                return resolve(self[importFunctionName].moduleMap[absURL]);\n            }\n            const moduleBlob = new Blob([\n                `import * as m from '${absURL}';`,\n                `${importFunctionName}.moduleMap['${absURL}']=m;`\n            ], { type: 'text/javascript' });\n            const script = Object.assign(document.createElement('script'), {\n                type: 'module',\n                src: URL.createObjectURL(moduleBlob),\n                onerror() {\n                    reject(new Error(`Failed to import: ${url}`));\n                    cleanup(script);\n                },\n                onload() {\n                    resolve(self[importFunctionName].moduleMap[absURL]);\n                    cleanup(script);\n                }\n            });\n            document.head.appendChild(script);\n        });\n        self[importFunctionName].moduleMap = {};\n    }\n};__VITE_IS_MODERN__&&p(\"assets/\");","let scriptRel;const seen = {};export const __vitePreload = function preload(baseModule, deps) {\n    // @ts-ignore\n    if (!__VITE_IS_MODERN__ || !deps) {\n        return baseModule();\n    }\n    // @ts-ignore\n    if (scriptRel === undefined) {\n        // @ts-ignore\n        const relList = document.createElement('link').relList;\n        // @ts-ignore\n        scriptRel =\n            relList && relList.supports && relList.supports('modulepreload')\n                ? 'modulepreload'\n                : 'preload';\n    }\n    return Promise.all(deps.map((dep) => {\n        // @ts-ignore\n        if (dep in seen)\n            return;\n        // @ts-ignore\n        seen[dep] = true;\n        const isCss = dep.endsWith('.css');\n        const cssSelector = isCss ? '[rel=\"stylesheet\"]' : '';\n        // @ts-ignore check if the file is already preloaded by SSR markup\n        if (document.querySelector(`link[href=\"${dep}\"]${cssSelector}`)) {\n            return;\n        }\n        // @ts-ignore\n        const link = document.createElement('link');\n        // @ts-ignore\n        link.rel = isCss ? 'stylesheet' : scriptRel;\n        if (!isCss) {\n            link.as = 'script';\n            link.crossOrigin = '';\n        }\n        link.href = dep;\n        // @ts-ignore\n        document.head.appendChild(link);\n        if (isCss) {\n            return new Promise((res, rej) => {\n                link.addEventListener('load', res);\n                link.addEventListener('error', rej);\n            });\n        }\n    })).then(() => baseModule());\n}","import type { TransformOptions } from \"esbuild\";\n\ntype esbuild_t = typeof import(\"esbuild\");\n\nconst $ = (sel: string) => document.querySelector(sel)!;\n\nfunction leave(el: Element, ms = 200) {\n    el.classList.add(\"leave\", \"leave-active\");\n    requestAnimationFrame(() => {\n        el.classList.remove(\"leave\");\n        el.classList.add(\"leave-to\");\n    });\n    setTimeout(() => el.remove(), ms);\n}\n\nconst JsDelivrAPI = \"https://data.jsdelivr.com/v1/package/npm/esbuild-wasm\";\nconst urlPrefix = \"https://cdn.jsdelivr.net/npm/esbuild-wasm\";\nconst urls = {\n    // prettier-ignore\n    browser: (version: string) => `${urlPrefix}@${version}/esm/browser.js`,\n    wasm: (version: string) => `${urlPrefix}@${version}/esbuild.wasm`,\n};\n\nlet esbuild: esbuild_t | undefined;\nconst utils = {\n    async fetchVersion() {\n        const r = await fetch(JsDelivrAPI).then((r) => r.json());\n        const version = r.tags.latest;\n        localStorage.setItem(\"esbuild-repl\", `${version}:${Date.now()}`);\n        return version;\n    },\n    async version() {\n        const raw = localStorage.getItem(\"esbuild-repl\");\n        if (raw) {\n            const [version, time] = raw.split(\":\", 2);\n            if (Date.now() - +time < 86400 * 7 * 1000) {\n                return version;\n            }\n        }\n        return this.fetchVersion();\n    },\n    async esbuild(version: string) {\n        esbuild = (await import(/* @vite-ignore */ urls.browser(version))) as esbuild_t;\n        await esbuild.initialize({ wasmURL: urls.wasm(version) });\n    },\n    dashize(str: string) {\n        return str.replace(/([A-Z])/g, (x) => \"-\" + x.toLowerCase());\n    },\n    camelize(str: string) {\n        return str.replace(/-([a-z])/g, (x) => x.substring(1).toUpperCase());\n    },\n    cfg2cli(config: Record<string, any>) {\n        const options: string[] = [];\n        for (const key in config) {\n            const value = config[key as keyof TransformOptions];\n            if (Array.isArray(value)) {\n                for (const e of value) {\n                    options.push(`--${this.dashize(key)}:${e}`);\n                }\n            } else if (value instanceof Object) {\n                for (const [k, v] of Object.entries(value)) {\n                    options.push(`--${this.dashize(key)}:${k}=${v}`);\n                }\n            } else if (value === true) {\n                options.push(`--${this.dashize(key)}`);\n            } else {\n                options.push(`--${this.dashize(key)}=${value}`);\n            }\n        }\n        return options.join(\" \");\n    },\n    cli2cfg(line: string) {\n        const config: Record<string, any> = {};\n        for (const piece of line.split(/\\s+/)) {\n            if (!piece.startsWith(\"--\")) continue;\n            const a = piece.substring(2);\n            const colon = a.indexOf(\":\");\n            const equal = a.indexOf(\"=\");\n            if (colon === -1 && equal === -1) {\n                config[this.camelize(a)] = true;\n            } else {\n                if (colon !== -1 && colon < equal) {\n                    const key = a.substring(0, colon);\n                    const [k, v] = a.substring(colon + 1).split(\"=\", 2);\n                    config[key] ||= {};\n                    config[key][k] = v;\n                } else if (colon !== -1 && equal === -1) {\n                    const [key, value] = a.split(\":\", 2);\n                    config[key] ||= [];\n                    config[key].push(value);\n                } else {\n                    const [key, value] = a.split(\"=\", 2);\n                    const val = { true: true, false: false }[value] || value;\n                    config[key] = val;\n                }\n            }\n        }\n        return config;\n    },\n    showError(message: string) {\n        const el = $(\"#error\") as HTMLElement;\n        el.style.display = \"\";\n        el.textContent = message;\n    },\n    hideError() {\n        const el = $(\"#error\") as HTMLElement;\n        el.style.display = \"none\";\n    },\n};\n\n(async function () {\n    const version = await utils.version();\n    $(\"#version\").textContent = version;\n    await utils.esbuild(version);\n    leave($(\"#mask\"));\n\n    (window as any).esbuild = esbuild;\n\n    let config: Record<string, any> = {\n        loader: \"tsx\",\n    };\n\n    $(\"#config\").addEventListener(\"change\", (e) => {\n        const el = e.target as HTMLInputElement;\n        config = utils.cli2cfg(el.value);\n        el.value = utils.cfg2cli(config);\n    });\n\n    $(\"#editor\").addEventListener(\"keydown\", (e) => {\n        if ((e as KeyboardEvent).key === \"Tab\") {\n            e.preventDefault();\n            const textarea = e.target as HTMLTextAreaElement;\n            const code = textarea.value;\n            const before = code.substring(0, textarea.selectionStart);\n            const endPos = textarea.selectionEnd;\n            const after = code.substring(endPos);\n            textarea.value = before + \"    \" + after;\n            textarea.selectionStart = textarea.selectionEnd = endPos + 4;\n        }\n    });\n\n    async function refresh() {\n        const code = ($(\"#editor\") as HTMLTextAreaElement).value;\n        try {\n            const result = await esbuild?.transform(code, config);\n            if (result) {\n                ($(\"#output\") as HTMLTextAreaElement).value = result.code;\n                utils.hideError();\n            }\n        } catch (e) {\n            utils.showError(e.message);\n        }\n    }\n\n    $(\"#editor\").addEventListener(\"input\", refresh);\n\n    refresh();\n})().catch((reason) => {\n    console.error(reason);\n    $(\"#mask\").textContent = reason?.message || reason;\n});\n"],"names":["modulePath","importFunctionName","Function","error","baseURL","URL","location","cleanup","script","revokeObjectURL","src","remove","url","Promise","resolve","reject","absURL","self","moduleMap","moduleBlob","Blob","type","Object","assign","document","createElement","createObjectURL","[object Object]","Error","head","appendChild","p","scriptRel","seen","$","sel","querySelector","urlPrefix","urls","version","esbuild","utils","fetch","then","r2","json","tags","latest","setItem","Date","now","raw","localStorage","getItem","time","split","this","fetchVersion","baseModule","deps","relList","supports","all","map","dep","isCss","endsWith","cssSelector","link","rel","as","crossOrigin","href","res","rej","addEventListener","__vitePreload","initialize","wasmURL","dashize","str","replace","x","toLowerCase","camelize","substring","toUpperCase","config","options","key","value","Array","isArray","e","push","k","v","entries","join","line","piece","startsWith","a","colon","indexOf","equal","val","true","false","message","el","style","display","textContent","ms","classList","add","loader","code","result","transform","hideError","showError","target","cli2cfg","cfg2cli","preventDefault","textarea","before","selectionStart","endPos","selectionEnd","after","refresh","catch","reason"],"mappings":"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"}