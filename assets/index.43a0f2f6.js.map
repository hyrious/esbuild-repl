{"version":3,"file":"index.43a0f2f6.js","sources":["../../vite/preload-helper","../../node_modules/@hyrious/esbuild-dev/dist/chunks/dep-P52XZR2I.mjs","../../main.ts"],"sourcesContent":["let scriptRel;const seen = {};const base = '';export const __vitePreload = function preload(baseModule, deps) {\n    // @ts-ignore\n    if (!__VITE_IS_MODERN__ || !deps || deps.length === 0) {\n        return baseModule();\n    }\n    // @ts-ignore\n    if (scriptRel === undefined) {\n        // @ts-ignore\n        const relList = document.createElement('link').relList;\n        // @ts-ignore\n        scriptRel =\n            relList && relList.supports && relList.supports('modulepreload')\n                ? 'modulepreload'\n                : 'preload';\n    }\n    return Promise.all(deps.map((dep) => {\n        // @ts-ignore\n        dep = `${base}${dep}`;\n        // @ts-ignore\n        if (dep in seen)\n            return;\n        // @ts-ignore\n        seen[dep] = true;\n        const isCss = dep.endsWith('.css');\n        const cssSelector = isCss ? '[rel=\"stylesheet\"]' : '';\n        // @ts-ignore check if the file is already preloaded by SSR markup\n        if (document.querySelector(`link[href=\"${dep}\"]${cssSelector}`)) {\n            return;\n        }\n        // @ts-ignore\n        const link = document.createElement('link');\n        // @ts-ignore\n        link.rel = isCss ? 'stylesheet' : scriptRel;\n        if (!isCss) {\n            link.as = 'script';\n            link.crossOrigin = '';\n        }\n        link.href = dep;\n        // @ts-ignore\n        document.head.appendChild(link);\n        if (isCss) {\n            return new Promise((res, rej) => {\n                link.addEventListener('load', res);\n                link.addEventListener('error', rej);\n            });\n        }\n    })).then(() => baseModule());\n}","var __defProp = Object.defineProperty;\nvar __getOwnPropSymbols = Object.getOwnPropertySymbols;\nvar __hasOwnProp = Object.prototype.hasOwnProperty, __propIsEnum = Object.prototype.propertyIsEnumerable;\nvar __defNormalProp = (obj, key, value) => key in obj ? __defProp(obj, key, { enumerable: !0, configurable: !0, writable: !0, value }) : obj[key] = value, __spreadValues = (a, b) => {\n  for (var prop in b || (b = {}))\n    __hasOwnProp.call(b, prop) && __defNormalProp(a, prop, b[prop]);\n  if (__getOwnPropSymbols)\n    for (var prop of __getOwnPropSymbols(b))\n      __propIsEnum.call(b, prop) && __defNormalProp(a, prop, b[prop]);\n  return a;\n};\nvar __require = (x) => {\n  if (typeof require != \"undefined\")\n    return require(x);\n  throw new Error('Dynamic require of \"' + x + '\" is not supported');\n};\n\n// src/args.ts\nvar cliRE = /^--([-a-z]+)(?::([^=]+))?(?:=(.+))?$/, booleans = { true: !0, false: !1 };\nfunction argsToBuildOptions(args) {\n  let buildOptions = {};\n  for (let arg of args) {\n    let m = cliRE.exec(arg);\n    if (m) {\n      let [, slashKey, subKey, value] = m, key = camelize(slashKey);\n      if (subKey && value)\n        (buildOptions[key] || (buildOptions[key] = {}))[subKey] = value;\n      else if (subKey)\n        (buildOptions[key] || (buildOptions[key] = [])).push(subKey);\n      else if (value) {\n        let bool = booleans[value];\n        bool !== void 0 ? buildOptions[key] = bool : value.includes(\",\") ? buildOptions[key] = value.split(\",\") : buildOptions[key] = value;\n      } else\n        buildOptions[key] = !0;\n    } else\n      throw new Error(`unknown arg: ${arg}`);\n  }\n  return buildOptions;\n}\nfunction camelize(s) {\n  return s.split(\"-\").reduce((a, b) => a + capitalize(b));\n}\nfunction capitalize(s) {\n  return s.charAt(0).toUpperCase() + s.slice(1);\n}\nfunction buildOptionsToArgs(options) {\n  let args = [];\n  Array.isArray(options.entryPoints) ? args.push(...options.entryPoints) : options.entryPoints && args.push(...Object.entries(options.entryPoints).map(([k, v]) => `${k}=${v}`)), delete options.entryPoints, delete options.plugins;\n  for (let [k, v] of Object.entries(options)) {\n    let key = dashize(k);\n    Array.isArray(v) ? [\"resolveExtensions\", \"mainFields\", \"conditions\", \"target\"].includes(k) ? args.push(`--${key}=${v.join(\",\")}`) : args.push(...v.map((value) => `--${key}:${value}`)) : typeof v == \"object\" && v !== null ? args.push(...Object.entries(v).map(([sub, val]) => `--${key}:${sub}=${JSON.stringify(val)}`)) : args.push(`--${key}=${v}`);\n  }\n  return args;\n}\nfunction dashize(s) {\n  return s.replace(/([A-Z])/g, (x) => \"-\" + x.toLowerCase());\n}\n\nexport {\n  __spreadValues,\n  __require,\n  argsToBuildOptions,\n  buildOptionsToArgs\n};\n//# sourceMappingURL=dep-P52XZR2I.mjs.map\n","import type { TransformOptions } from \"esbuild\";\nimport { argsToBuildOptions, buildOptionsToArgs } from \"@hyrious/esbuild-dev/args\";\n\ntype esbuild_t = typeof import(\"esbuild\");\n\nconst $ = (sel: string) => document.querySelector(sel)!;\n\nfunction leave(el: Element, ms = 200) {\n    el.classList.add(\"leave\", \"leave-active\");\n    requestAnimationFrame(() => {\n        el.classList.remove(\"leave\");\n        el.classList.add(\"leave-to\");\n    });\n    setTimeout(() => el.remove(), ms);\n}\n\nconst JsDelivrAPI = \"https://data.jsdelivr.com/v1/package/npm/esbuild-wasm\";\nconst urlPrefix = \"https://cdn.jsdelivr.net/npm/esbuild-wasm\";\nconst urls = {\n    browser: (version: string) => `${urlPrefix}@${version}/esm/browser.js`,\n    wasm: (version: string) => `${urlPrefix}@${version}/esbuild.wasm`,\n};\n\nlet esbuild: esbuild_t | undefined;\nconst utils = {\n    async fetchVersion() {\n        const r = await fetch(JsDelivrAPI).then((r) => r.json());\n        const version = r.tags.latest;\n        localStorage.setItem(\"esbuild-repl\", `${version}:${Date.now()}`);\n        return version;\n    },\n    async version() {\n        const raw = localStorage.getItem(\"esbuild-repl\");\n        if (raw) {\n            const [version, time] = raw.split(\":\", 2);\n            if (Date.now() - +time < 86400 * 7 * 1000) {\n                return version;\n            }\n        }\n        return this.fetchVersion();\n    },\n    async esbuild(version: string) {\n        esbuild = (await import(/* @vite-ignore */ urls.browser(version))) as esbuild_t;\n        await esbuild.initialize({ wasmURL: urls.wasm(version) });\n    },\n    cfg2cli(config: Record<string, any>) {\n        return buildOptionsToArgs(config).join(\" \");\n    },\n    cli2cfg(line: string) {\n        return argsToBuildOptions(line.split(/\\s+/)) as TransformOptions;\n    },\n    loadQuery() {\n        const query = new URLSearchParams(location.search.slice(1));\n        const version = query.get(\"version\");\n        const shareableString = query.get(\"shareable\");\n        let shareable: { code: string; config: Record<string, any> } | null = null;\n        if (shareableString) {\n            try {\n                shareable = JSON.parse(decodeURIComponent(atob(shareableString)));\n            } catch {}\n        }\n        return { version, shareable };\n    },\n    updateQuery(version: string, shareable: object) {\n        const query = new URLSearchParams();\n        query.set(\"version\", version);\n        query.set(\"shareable\", btoa(encodeURIComponent(JSON.stringify(shareable))));\n        const url = location.origin + location.pathname + \"?\" + query.toString();\n        history.pushState({ path: url }, \"\", url);\n    },\n    showError(message: string) {\n        const el = $(\"#error\") as HTMLElement;\n        el.style.display = \"\";\n        el.textContent = message;\n    },\n    hideError() {\n        const el = $(\"#error\") as HTMLElement;\n        el.style.display = \"none\";\n    },\n};\n\n(async function () {\n    const query = utils.loadQuery();\n    console.log(query);\n\n    $(\"#theme\").addEventListener(\"click\", () => {\n        document.body.classList.toggle(\"light\");\n    });\n    const version = query.version || (await utils.version());\n    $(\"#version\").textContent = version;\n    await utils.esbuild(version);\n    leave($(\"#mask\"));\n\n    (window as any).esbuild = esbuild;\n\n    let $config = $(\"#config\") as HTMLInputElement;\n    let $output = $(\"#output\") as HTMLTextAreaElement;\n    let $editor = $(\"#editor\") as HTMLTextAreaElement;\n\n    if (query.shareable?.config != null) {\n        $config.value = utils.cfg2cli(query.shareable?.config);\n    }\n\n    if (query.shareable?.code != null) {\n        $editor.value = query.shareable?.code;\n        $output.value = \"// initializing...\";\n    }\n\n    let config = utils.cli2cfg($config.value);\n    let code = $editor.value;\n\n    $config.addEventListener(\"change\", () => {\n        config = utils.cli2cfg($config.value);\n        $config.value = utils.cfg2cli(config);\n        refresh();\n    });\n\n    $editor.addEventListener(\"keydown\", (e: KeyboardEvent) => {\n        if (e.key === \"Tab\") {\n            e.preventDefault();\n            const textarea = $editor;\n            const code = textarea.value;\n            const before = code.substring(0, textarea.selectionStart);\n            const endPos = textarea.selectionEnd;\n            const after = code.substring(endPos);\n            textarea.value = before + \"    \" + after;\n            textarea.selectionStart = textarea.selectionEnd = endPos + 4;\n        }\n    });\n\n    async function refresh(first = false) {\n        code = $editor.value;\n        try {\n            const t = performance.now();\n            const result = await esbuild?.transform(code, config);\n            const duration = performance.now() - t;\n            if (result) {\n                $output.value = result.code;\n                utils.hideError();\n                if (!first) $(\"#duration\").textContent = duration.toFixed(2) + \"ms\";\n            }\n        } catch (e) {\n            utils.showError(e.message);\n        }\n        try {\n            utils.updateQuery(version, { code, config });\n        } catch {}\n    }\n\n    $editor.addEventListener(\"input\", () => refresh(false));\n\n    refresh(true);\n})().catch((reason) => {\n    console.error(reason);\n    $(\"#mask\").textContent = reason?.message || reason;\n});\n\nif (import.meta.env.PROD)\n    navigator.serviceWorker\n        .register(\"./sw.js\")\n        .then((e) => console.log(\"registered sw.js in scope:\", e.scope))\n        .catch((e) => console.log(\"failed to register sw.js:\", e));\n"],"names":["scriptRel","seen","cliRE","booleans","true","false","$","sel","document","querySelector","urlPrefix","urls","version","esbuild","utils","fetch","then","r2","json","tags","latest","setItem","Date","now","raw","localStorage","getItem","time","split","this","fetchVersion","baseModule","deps","length","relList","createElement","supports","Promise","all","map","dep","isCss","endsWith","cssSelector","link","rel","as","crossOrigin","href","head","appendChild","res","rej","addEventListener","__vitePreload","initialize","wasmURL","cfg2cli","config","options","args","isArray","entryPoints","push","Object","entries","k","v","plugins","key","replace","x","toLowerCase","includes","join","value","sub","val","JSON","stringify","buildOptionsToArgs","cli2cfg","line","buildOptions","arg","m","exec","Error","slashKey","subKey","reduce","a","b","s","charAt","toUpperCase","slice","bool","argsToBuildOptions","loadQuery","query","URLSearchParams","location","search","get","shareableString","shareable","parse","decodeURIComponent","atob","updateQuery","set","btoa","encodeURIComponent","url","origin","pathname","toString","pushState","path","showError","message","el","style","display","textContent","hideError","log","body","classList","toggle","ms","add","remove","$config","$output","$editor","code","first","t","performance","result","transform","duration","toFixed","e","preventDefault","textarea","code2","before","substring","selectionStart","endPos","selectionEnd","after","refresh","catch","reason","error","serviceWorker","register","console","scope"],"mappings":"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"}