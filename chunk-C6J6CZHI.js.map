{
  "version": 3,
  "sources": ["../src/behaviors/esbuild.ts", "../src/behaviors/theme.ts"],
  "sourcesContent": ["import pRetry from \"p-retry\";\nimport { delay, getQuery, isBrowser, isDef, noop } from \"../helpers\";\nimport {\n  esbuild as $esbuild,\n  loading as $loading,\n  status as $status,\n  version as $version,\n} from \"../stores\";\n\ntype esbuild_t = typeof import(\"esbuild\");\n\nconst prefixes = [\"https://cdn.jsdelivr.net/npm\", \"https://unpkg.com\"];\nconst jsUrl = (i: number, ver: string) => `${prefixes[i]}/esbuild-wasm@${ver}/lib/browser.min.js`;\nconst wasmUrl = (i: number, ver: string) => `${prefixes[i]}/esbuild-wasm@${ver}/esbuild.wasm`;\n\nasync function load() {\n  const version = getQuery().version || \"latest\";\n  console.log(\"loading esbuild @\", version);\n\n  let module = {\n    initialize: noop,\n    build: noop,\n    formatMessages: noop,\n    transform: noop,\n    version: \"none\",\n  } as Partial<esbuild_t> as esbuild_t;\n\n  if (!isBrowser) {\n    $esbuild.set(module);\n    return;\n  }\n\n  if (import.meta.env.DEV) {\n    $status.set(\"Fetching esbuild @ \" + version);\n    ({ default: module } = await import(\"esbuild-wasm\"));\n    window.esbuild = module;\n    $version.set(module.version);\n    $status.set(\"Downloading esbuild.wasm @ \" + version);\n    await module.initialize({ wasmURL: \"http://localhost:30000/esbuild.wasm\" });\n    await module.transform(\"let a = 1\");\n    $esbuild.set(module);\n    console.log(\"loaded esbuild @\", module.version);\n    return;\n  }\n\n  for (let i = 0; i < prefixes.length; ++i) {\n    try {\n      const jsURL = jsUrl(i, version);\n      $status.set(\"Fetching \" + jsURL);\n      await pRetry(() => report(script(jsURL, () => isDef(window.esbuild))), { retries: 3 });\n      module = window.esbuild as esbuild_t;\n      $version.set(module.version);\n      const wasmURL = wasmUrl(i, module.version);\n      $status.set(\"Downloading \" + wasmURL);\n      await pRetry(() => report(module.initialize({ wasmURL })), { retries: 3 });\n      await module.transform(\"let a = 1\"); // warm up\n      break;\n    } catch {\n      continue;\n    }\n  }\n\n  if (module.version === \"none\") {\n    throw new Error(\"Error: failed to load esbuild-wasm, try refresh the page.\");\n  }\n\n  $esbuild.set(module);\n  console.log(\"loaded esbuild @\", module.version);\n}\n\nasync function report<T>(promise: Promise<T>) {\n  try {\n    return await promise;\n  } catch (err) {\n    $status.set(String(err));\n    console.error(err);\n    throw err;\n  }\n}\n\nfunction script(src: string, isReady: () => boolean) {\n  return new Promise<void>((resolve, reject) => {\n    const script = document.createElement(\"script\");\n    script.onload = async () => {\n      if (isReady()) resolve();\n      for (let i = 0; i < 10; ++i) {\n        await delay(100);\n        if (isReady()) resolve();\n      }\n      reject(new Error(`Failed to import ${src}.`));\n    };\n    script.onerror = () => {\n      script.remove();\n      reject();\n    };\n    script.src = src;\n    document.head.append(script);\n  });\n}\n\n(async () => {\n  try {\n    await load();\n    $status.set(\"Ready.\");\n    $loading.set(false);\n  } catch (err) {\n    $status.set(String(err));\n    console.error(err);\n  }\n})();\n", "import { isBrowser } from \"../helpers\";\nimport { theme } from \"../stores\";\n\nconst mediaQuery =\n  isBrowser && window.matchMedia ? matchMedia(\"(prefers-color-scheme: dark)\") : null;\n\nif (mediaQuery) {\n  const update = () => theme.set(mediaQuery.matches ? \"dark\" : \"light\");\n  mediaQuery.addEventListener(\"change\", update);\n  update();\n}\n\ntheme.subscribe((value) => {\n  if (isBrowser) {\n    document.body.dataset.theme = value;\n  }\n});\n"],
  "mappings": "ygJAWA,GAAM,GAAW,CAAC,+BAAgC,qBAC5C,EAAQ,CAAC,EAAW,IAAgB,GAAG,EAAS,mBAAmB,uBACnE,EAAU,CAAC,EAAW,IAAgB,GAAG,EAAS,mBAAmB,iBAE3E,kBAAsB,CACpB,GAAM,GAAU,IAAW,SAAW,SACtC,QAAQ,IAAI,oBAAqB,GAEjC,GAAI,GAAS,CACX,WAAY,EACZ,MAAO,EACP,eAAgB,EAChB,UAAW,EACX,QAAS,QAGX,GAAI,CAAC,EAAW,CACd,EAAS,IAAI,GACb,OAgBF,OAAS,GAAI,EAAG,EAAI,EAAS,OAAQ,EAAE,EACrC,GAAI,CACF,GAAM,GAAQ,EAAM,EAAG,GACvB,EAAQ,IAAI,YAAc,GAC1B,KAAM,GAAO,IAAM,EAAO,EAAO,EAAO,IAAM,EAAM,OAAO,WAAY,CAAE,QAAS,IAClF,EAAS,OAAO,QAChB,EAAS,IAAI,EAAO,SACpB,GAAM,GAAU,EAAQ,EAAG,EAAO,SAClC,EAAQ,IAAI,eAAiB,GAC7B,KAAM,GAAO,IAAM,EAAO,EAAO,WAAW,CAAE,aAAa,CAAE,QAAS,IACtE,KAAM,GAAO,UAAU,aACvB,WACA,CACA,SAIJ,GAAI,EAAO,UAAY,OACrB,KAAM,IAAI,OAAM,6DAGlB,EAAS,IAAI,GACb,QAAQ,IAAI,mBAAoB,EAAO,SAGzC,iBAAyB,EAAqB,CAC5C,GAAI,CACF,MAAO,MAAM,SACN,EAAP,CACA,QAAQ,IAAI,OAAO,IACnB,QAAQ,MAAM,GACR,GAIV,WAAgB,EAAa,EAAwB,CACnD,MAAO,IAAI,SAAc,CAAC,EAAS,IAAW,CAC5C,GAAM,GAAS,SAAS,cAAc,UACtC,EAAO,OAAS,SAAY,CAC1B,AAAI,KAAW,IACf,OAAS,GAAI,EAAG,EAAI,GAAI,EAAE,EACxB,KAAM,GAAM,KACR,KAAW,IAEjB,EAAO,GAAI,OAAM,oBAAoB,QAEvC,EAAO,QAAU,IAAM,CACrB,EAAO,SACP,KAEF,EAAO,IAAM,EACb,SAAS,KAAK,OAAO,KAIzB,AAAC,UAAY,CACX,GAAI,CACF,KAAM,KACN,EAAQ,IAAI,UACZ,EAAS,IAAI,UACN,EAAP,CACA,EAAQ,IAAI,OAAO,IACnB,QAAQ,MAAM,QCxGlB,GAAM,GACJ,GAAa,OAAO,WAAa,WAAW,gCAAkC,KAEhF,GAAI,EAAY,CACd,GAAM,GAAS,IAAM,EAAM,IAAI,EAAW,QAAU,OAAS,SAC7D,EAAW,iBAAiB,SAAU,GACtC,IAGF,EAAM,UAAU,AAAC,GAAU,CACzB,AAAI,GACF,UAAS,KAAK,QAAQ,MAAQ",
  "names": []
}
